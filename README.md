# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

Карточка товара (по запросу на сервер)

```
export interface IProduct {
	id: string;
	name: string;
	price: number | null;
	description: string;
	category: string;
	image: string;
}
```

Модель хранения массива товаров

```
export interface IItemsData  {
	basket: IProduct[];
	items: IProduct[];
	preview: string | null;
	order: IOrder | null;
}
```

Корзина

```
export interface IBasket {
	items: IProduct[];
	total: number;
}
```

Условия заказа

```
export interface IOrderForm {
	payment: string;
	address: string;
}
```

Контактные данные для заказа

```
export interface IContactsForm {
	email: string;
	phone: string;
}
```

Заказ

```
export interface IOrder extends IOrderForm, IContactsForm {
	items: string[];
	total: number;
}
```

Оплаченный заказ

```
export interface IPayedOrder {
    id: string;
    total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс AppState

Класс отвечает за хранение и логику работы с товарами.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- items: IProduct[] - массив карточек переданный от сервера
- basket: IProduct[] - массив карточек в корзине
- order: IOrder - в свойстве хранится объект заказа, который будет отправлен на сервер
- preview: string | null - id товара для просмотра
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы класса:

- updateItem(item: IItem): void; - обновляет данные карточки в массиве.
- getItem(itemId: string): IItem; - возвращает товар по его id
- clearBasket(): void - метод отчистки корзины
- getTotal(): number - возвращает общую сумму заказа
- setCatalog(items: IProduct[]) - метод создания каталога товаров переданных от сервера
- setPreview(item: IItem) - метод формирования превью товара при событии клика по карточке товара

Также методы setPaymentField, setAddressField, setContactsField, которые заполняют соответствующие поля заказа.

И методы валидации данных для заказа validateOrder, validateContacts.

#### Класс Item

Данный класс отвечает за хранение и работу со всеми товарами, представленными в магазине (переданными по запросу от сервера).
Поля класс:

- id: string;
- description: string;
- image: string;
- title: string;
- category: string;
- price: number | null;

#### Класс Basket

Класс отвечает за хранение и логику работы с товарами, добавленными в корзину.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- items: IProduct[] - массив товаров добавленных в карзину
- total: number - общая стоимость всех товаров в карзине
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы класса:

- getItems(): IProduct[] - возвращает массив товаров в корзине
- addItem(item: IProduct) - добавляет товар в корзину
- removeItem(itemToRemove: IProduct) - удаляет товар из корзины
- clearBasket() - очищает корзину
- getTotal() - возвращает общую сумму товаров в корзине

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Component

Абстрактный класс, от которого наследуют методы все остальные классы представления

Методы:

- toggleClass(element: HTMLElement, className: string, force?: boolean) - Переключить класс
- setText(element: HTMLElement, value: unknown) - Установить текстовое содержимое
- setHidden(element: HTMLElement) - Скрыть элемент
- setVisible(element: HTMLElement) - показать элемент
- render(data?: Partial<T>): HTMLElement - возвращает корневой DOM-элемент

#### Класс Page

Класс представления главной страницы. Свойствами класс будут такие элементы страниы, как каталог товаров, кнопка корзины, счетчик товаров в корзине.

Методы:

- counter(value: number) - сеттер счетчика
- catalog(items: HTMLElement[]) - сеттер каталога товаров

#### Класс ItemCard

Отвечает за отображение карточки товара. Класс используется для отображения карточки товара на главной странице, в модальном окне и в корзине. В конструктор класса передается DOM элемент темплейта для формирования карточки в разных вариантах верстки. \
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий. Для полей класса реализованы ссеттеры и геттеры. \

Поля класса:

- title: HTMLElement;
- image: HTMLImageElement;
- description?: HTMLElement;
- button: HTMLButtonElement;
- category: HTMLElement
- price: HTMLElement

#### Класс Modal

Реализует модальное окно. Предоставляет методы `open` и `close` для его открытия и закрытия, сеттер для отображения контента в модальном окне. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса

- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс BasketModal

Реалезует модальное окно корзины, в котором отображается список карточек, общая стоимость товаров корзине и кнопка оформления заказа. При нажатии кнопки оформления заказа создается объект заказа.

- constructor(selector: string, events: IEvents) Конструктор принимает темплейт для отображения корзины в модальном окне и экземпляр класса `EventEmitter` для возможности инициации событий. Добавляется слушатель на кнопку для создания заказа.

Поля класса

- \_list: HTMLElement - в данном элементе отображается список карточек
- \_total: HTMLElement - общая стоимость товаров в корзине
- \_button: HTMLElement - кнопка оформления заказа

Методы:

- items(items: HTMLElement[]) - сеттер для отображения списка карточек
- total(total: number) - сеттер для отображения общей суммы

#### Класс Form

Общий класс для всех форм. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

- constructor(protected container: HTMLFormElement, protected events: IEvents) Конструктор принимает темплейт для отображения формы в модальном окне и экземпляр класса `EventEmitter` для возможности инициации событий. Добавляются слушатели на кнопку сабмита и поля ввода.

Поля класса:

- \_submit: HTMLButtonElement
- \_errors: HTMLElement

Методы:

- onInputChange(field: keyof T, value: string) - создает эмит события изменения данных value в поле ввода field
  Сеттеры свойств valid (отвечает за блокировку кнопки сабмита) и errors (для отображения ошибок в форме)

#### Класс OrderInfoForm

Реалезует модальное окно с формой информации о заказе. При сабмите данные из формы присваиваются соответствующим полям объекта заказа.

Поля класса:

- \_paymentContainer: HTMLDivElement - контейнер с выбором способа оплаты
- \_paymentButton: HTMLButtonElement[] - кнопки способа оплаты
- \_addressInput: HTMLInputElement - поля адреса

Методы:

- setPayment(className: string) - спопсоб оплаты определяется по свойству name нажатой кнопки из предствленных на форме

Также сеттер свойства address

#### Класс OrderContactsForm

Реалезует модальное окно с формой контактных данных пользователя. При сабмите данные из формы присваиваются соответствующим полям объекта заказа.

Методы:

Сеттеры свойств phone и email

#### Класс OrderSuccess

Данный класс нужен для подтверждения успешной оплаты заказа.
При открытии модально окна, получает данные о стоимости уже оплаченного заказа.

- constructor(selector: string, events: IEvents) Конструктор принимает темплейт для отображения успешности оплаты в модальном окне и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класс:

- total: number - поле стоимости заказа

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.

_Список всех событий, которые могут генерироваться в системе:_

- `items:changed` - изменение массива карточек товаров
- `item:selected` - клик по карточке товара на главной странице
- `preview:changed` - изменение открываемой в модальном окне карточки товара
- `basket:open` - открытие модального окна корзины
- `basket:changed` - изменение количества товаров в корзине и итоговой суммы
- `basket:order` - окрывается первая форма заказа / создание заказа
- `order.payment:change` - меняется способ оплаты
- `order.address:change` - меняется адрес
- `orderFormErrors:change` - отображаются ошибки формы и блокируется кнопка оформления
- `order:submit` - открывается форма контактных данных
- `contacts.phone:change` - меняется телефон
- `contacts.email:change` - меняется электронная почта
- `contactsFormErrors:change` - отображаются ошибки формы и блокируется кнопка оформления
- `contacts:submit` - отправляется запрос на сервер с заказом, открывается модальное окно с подтверждение оплаты
