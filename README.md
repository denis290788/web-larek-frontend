# Проектная работа "Веб-ларек"

https://denis290788.github.io/web-larek-frontend/

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

Карточка товара (по запросу на сервер)

```
export interface IProduct {
	id: string;
	name: string;
	price: number | null;
	description: string;
	category: string;
	image: string;
}
```

Модель хранения массива товаров

```
export interface IItemsData  {
	basket: IProduct[];
	items: IProduct[];
	preview: string | null;
	order: IOrder | null;
}
```

Корзина

```
export interface IBasket {
	items: IProduct[];
	total: number;
}
```

Условия заказа

```
export interface IOrderForm {
	payment: string;
	address: string;
}
```

Контактные данные для заказа

```
export interface IContactsForm {
	email: string;
	phone: string;
}
```

Заказ

```
export interface IOrder extends IOrderForm, IContactsForm {
	items: string[];
	total: number;
}
```

Оплаченный заказ

```
export interface IPayedOrder {
    id: string;
    total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

`constructor(baseUrl: string, options: RequestInit = {})`- Конструктор принимает два параметра: baseUrl - URL, к которому будут добавляться относительные пути при отправке запросов, и options - опции запроса, передаваемые в виде объекта RequestInit. Если эти опции не предоставлены при вызове конструктора, используются пустые объекты по умолчанию.

Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` метод используется для обработки ответа от сервера после отправки запроса. Этот метод принимает объект Response, представляющий ответ от сервера, и возвращает Promise, содержащий данные ответа или отклонение сообщением об ошибке, если ответ от сервера не был успешным.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс Model

Класс `Model<T>` - это абстрактный класс, параметризованный типом T.

`constructor(data: Partial<T>, protected events: IEvents)` - Конструктор класса принимает объект данных data типа `Partial<T>` и объект событий events типа `IEvents`.

Метод `emitChanges` используется для генерации событий через объект событий `events`.

#### Класс AppState

Класс отвечает за хранение и логику работы с товарами.\
Используют абстрактный класс `Model<T>`.

В полях класса хранятся следующие данные:

- items: IProduct[] - массив карточек переданный от сервера
- basket: IProduct[] - массив карточек в корзине
- order: IOrder - в свойстве хранится объект заказа, который будет отправлен на сервер
- preview: string | null - id товара для просмотра
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- formErrors: FormErrors - Это поле содержит ошибки формы заказа. Если введенные данные невалидны, соответствующие ошибки будут записаны в это поле. FormErrors - это тип данных, описывающий структуру ошибок формы заказа.

Методы класса:

- `setCatalog(items: IProduct[]): void:` Этот метод устанавливает каталог товаров в приложении.
- `setPreview(item: Item): void:` Метод устанавливает предпросмотр товара в приложении.
- `setPaymentField(value: string): void:` Этот метод устанавливает значение поля "способ оплаты" в заказе.
- `setAddressField(value: string): void:` Метод устанавливает значение поля "адрес" в заказе.
- `setContactsField(field: keyof IContactsForm, value: string): void:` Этот метод устанавливает значение поля контактных данных (например, email или телефон) в заказе.
- `validateOrder(): boolean:` Метод осуществляет валидацию данных заказа.
- `validateContacts(): boolean:` Метод валидирует контактные данные заказа (например, email и телефон).
- `emitChanges(event: string, payload?: object): void:` Этот метод генерирует событие с указанным именем event.

#### Класс Item

Класс `Item` наследует абстрактный класс `Model<IProduct>`. Данный класс отвечает за хранение и работу со всеми товарами, представленными в магазине (переданными по запросу от сервера).
Поля класс:

- `id: string;` - Id карточки
- `description: string;` - описание товара
- `image: string;` - в поле хранится ссылка на картинку товара, котора отображается в карточке товара
- `title: string;` - наименование товара
- `category: string;` - категория товара
- `price: number | null;` - цена товара

#### Класс Basket

Класс отвечает за хранение и логику работы с товарами, добавленными в корзину.\

`constructor(events: IEvents):` Конструктор класса принимает объект событий events типа IEvents. Внутри конструктора вызывается конструктор родительского класса `Model<IBasket>`, который инициализирует объект событий и другие поля. Затем инициализируются поля items и total, представляющие собой массив товаров в корзине и общую стоимость заказа, соответственно.

В полях класса хранятся следующие данные:

- `items: IProduct[]` - массив товаров добавленных в карзину
- `total: number` - общая стоимость всех товаров в карзине

Методы класса:

- `getItems(): IProduct[]:` Метод getItems возвращает массив всех товаров, находящихся в корзине.
- `addItem(item: IProduct):` Метод addItem добавляет товар в корзину. Он принимает объект товара item типа IProduct и добавляет его в массив товаров корзины.
- `removeItem(itemToRemove: IProduct):` Метод removeItem удаляет товар из корзины. Он принимает объект товара itemToRemove типа IProduct и удаляет его из массива товаров корзины.
- `clearBasket():` Метод clearBasket очищает корзину, удаляя все товары из массива items.
- `getTotal(): number:` Метод getTotal вычисляет общую стоимость товаров в корзине.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Component

Абстрактный класс, от которого наследуют методы все остальные классы представления. Принимает дженерик `<T>`

`constructor(container: HTMLElement):` принимает контейнер container, в который будет помещен компонент разметки.

Методы:

- `toggleClass(element: HTMLElement, className: string, force?: boolean):` Метод используется для переключения класса CSS элемента element.
- `setText(element: HTMLElement, value: unknown):` Метод устанавливает текстовое содержимое элемента.
- `setDisabled(element: HTMLElement, state: boolean):` Метод устанавливает состояние "disabled" для элемента element в зависимости от значения состояния.
- `setHidden(element: HTMLElement):` Метод скрывает элемент element.
- `setVisible(element: HTMLElement):` Метод отображает скрытый элемент element.
- `setImage(element: HTMLImageElement, src: string, alt?: string):` Метод устанавливает изображение.
- `render(data?: Partial<T>): HTMLElement:` Метод используется для отрисовки компонента. Он принимает дженерик, который будет применен к компоненту. Если данные не переданы, метод просто возвращает контейнер компонента.

#### Класс Page

Класс Page наследует от класса `Component<IPage>`. Класс представления главной страницы. Свойствами класс будут такие элементы страницы, как каталог товаров, кнопка корзины, счетчик товаров в корзине.

`constructor(container: HTMLElement, events: IEvents):` Конструктор класса принимает два параметра: container - элемент, в который будет помещен компонент страницы, и events - объект событий.

Поля:

- `_counter: HTMLElement:` - счетчик товаров в корзине
- `_catalog: HTMLElement:` - каталог товаров на странице
- `_wrapper: HTMLElement:` - обертка страницы
- `_basket: HTMLButtonElement:` - кнопка корзины

Методы:

- `counter(value: number):` Это сеттер для поля counter, который устанавливает значение счетчика корзины.
- `catalog(items: HTMLElement[]):` Это сеттер для поля catalog, который устанавливает содержимое каталога товаров.
- `locked(value: boolean):` Это сеттер для поля locked, который устанавливает состояние блокировки страницы.

#### Класс ItemCard

Класс ItemCard наследует от класса `Component<ICard>`. Отвечает за отображение карточки товара. Класс используется для отображения карточки товара на главной странице, в модальном окне и в корзине. В конструктор класса передается DOM элемент темплейта для формирования карточки в разных вариантах верстки. \
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий. Для полей класса реализованы ссеттеры и геттеры. \

Поля класса:

- `_title: HTMLElement:` заголовок карточки товара
- `_price: HTMLElement:` цена товара
- `_image: HTMLImageElement | undefined:` изображение товара
- `_button: HTMLButtonElement | undefined:` кнопка, связанная с карточкой товара.
- `_description: HTMLElement | undefined:` описание товара
- `_category: HTMLElement | undefined:` категория товара
- `_index: HTMLElement | undefined:` индекс товара в корзине

`constructor(container: HTMLElement, actions?: ICardActions):` Конструктор класса принимает элемент-контейнер, в который будет помещен компонент разметки, и, при необходимости, объект действий actions на карточке товара.

Методы:

- toggleBasketButton(value: boolean): Этот метод позволяет переключать состояние кнопки, связанной с карточкой товара. Если value равно true, то кнопка становится активной, если value равно false, то кнопка становится неактивной. Для этого метод использует внутренний метод компонента setDisabled, который управляет атрибутом disabled кнопки.

- `set id(value: string):` устанавливает значение атрибута data-id контейнера карточки товара.
- `get id(): string:` возвращает значение идентификатора товара
- `set title(value: string):` устанавливает текстовое содержимое заголовка карточки товара.
- `get title(): string:` возвращает текстовое содержимое заголовка карточки товара.
- `set image(value: string):` устанавливает источник изображения для карточки товара.
- `set price(value: string):` устанавливает текстовое содержимое цены товара.
- `get price(): string:` возвращает текстовое содержимое цены товара.
- `set description(value: string):` устанавливает текстовое содержимое описания товара.
- `get description(): string:` возвращает текстовое содержимое описания товара.
- `set category(value: string):` устанавливает текстовое содержимое категории товара и применяет соответствующий класс CSS
- `get category(): string:` возвращает текстовое содержимое категории товара.
- `set index(value: string):` устанавливает текстовое содержимое индекса товара.

#### Класс Modal

Класс Modal наследует от класса `Component<IModalData>`. Реализует модальное окно. Предоставляет методы `open` и `close` для его открытия и закрытия, сеттер для отображения контента в модальном окне. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.

- `set content(value: HTMLElement):` устанавливает содержимое модального окна.
- `open():` открывает модальное окно.
- `close():` закрывает модальное окно
- `render(data: IModalData): HTMLElement:` рендерит модальное окно, используя переданные данные.

Поля класса

- `_closeButton: HTMLButtonElement:` кнопка закрытия модального окна.
- `_content: HTMLElement:` контент модального окна.

#### Класс BasketModal

Реалезует модальное окно корзины, в котором отображается список карточек, общая стоимость товаров корзине и кнопка оформления заказа. При нажатии кнопки оформления заказа создается объект заказа.

- constructor(selector: string, events: IEvents) Конструктор принимает темплейт для отображения корзины в модальном окне и экземпляр класса `EventEmitter` для возможности инициации событий. Добавляется слушатель на кнопку для создания заказа.

Поля класса

- `_list: HTMLElement:` список товаров в корзине.
- `_total: HTMLElement:` общая стоимость товаров в корзине.
- `_button: HTMLButtonElement:` кнопка оформления заказа.
- `_removeButton: HTMLButtonElement:` кнопка удаления товара из корзины.

Методы:

- `toggleOrderButton(value: boolean):` Этот метод позволяет переключать состояние кнопки оформления заказа.
- `set items(items: HTMLElement[]):` Этот метод устанавливает элементы списка товаров в корзине.
- `set total(total: string):` Этот метод устанавливает общую стоимость товаров в корзине.

#### Класс Form

Общий класс для всех форм. Принимает дженерик `<T>`. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

- constructor(protected container: HTMLFormElement, protected events: IEvents) Конструктор принимает темплейт для отображения формы в модальном окне и экземпляр класса `EventEmitter` для возможности инициации событий. Добавляются слушатели на кнопку сабмита и поля ввода.

Поля класса:

- `_submit: HTMLButtonElement:` кнопка отправки формы
- `_errors: HTMLElement:` элемент для отображения ошибок формы.

Методы:

- `onInputChange(field: keyof T, value: string):` метод вызывается при изменении значения в любом поле формы
- `set valid(value: boolean):` устанавливает состояние валидности формы.
- `set errors(value: string):` устанавливает сообщение об ошибке для отображения в форме.
- `render(state: Partial<T> & IFormState):` отображает текущее состояние формы, принимает объект состояния формы state, который включает в себя информацию о валидности формы и значения полей формы. Метод обновляет состояние формы и отображает сообщения об ошибках.

#### Класс OrderInfoForm

Наследует от класса `Form<IOrderForm>`. Реалезует модальное окно с формой информации о заказе. При сабмите данные из формы присваиваются соответствующим полям объекта заказа.

Поля класса:

- `_paymentContainer: HTMLDivElement:` контейнер для кнопок выбора метода оплаты.
- `_paymentButton: HTMLButtonElement[]:` кнопки выбора метода оплаты.
- `_addressInput: HTMLInputElement:` поле ввода адреса доставки

`constructor(container: HTMLFormElement, events: IEvents):` Конструктор принимает два параметра: container - элемент HTML-формы информации о заказе, и events - объект событий, используемый для взаимодействия с другими компонентами или модулями. В конструкторе инициализируются поля \_paymentContainer, \_paymentButton и \_addressInput, а также добавляется обработчик событий для выбора метода оплаты.

Методы:

- `setPayment(className: string):` устанавливает выбранный метод оплаты.
- `set address(value: string):` устанавливает значение адреса доставки.

#### Класс OrderContactsForm

Наследует класса `Form<IContactsForm>`. Реалезует модальное окно с формой контактных данных пользователя. При сабмите данные из формы присваиваются соответствующим полям объекта заказа.

`constructor(container: HTMLFormElement, events: IEvents):` Конструктор принимает два параметра: container - элемент HTML-формы контактных данных заказа, и events - объект событий, используемый для взаимодействия с другими компонентами или модулями. Конструктор вызывает конструктор родительского класса Form, передавая ему контейнер формы и объект событий.

Методы:

- `set phone(value: string):` устанавливает значение телефонного номера в соответствующем поле формы.
- `set email(value: string):` устанавливает значение электронной почты в соответствующем поле формы.

#### Класс OrderSuccess

Наследует от класса `Component<ISuccess>`. Данный класс нужен для подтверждения успешной оплаты заказа.
При открытии модального окна, получает данные о стоимости уже оплаченного заказа.

- constructor(selector: string, events: IEvents) Конструктор принимает темплейт для отображения успешности оплаты в модальном окне и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класс:

- `_total: HTMLElement:` элемент, отображающий общую сумму успешно оформленного заказа.

- `_close: HTMLButtonElement:` кнопка закрытия сообщения об успешном оформлении заказа.

Методы:

- `set total(value: string):` устанавливает общую сумму успешно оформленного заказа и отображает ее.
- `get total(): string:` возвращает текст, содержащий общую сумму успешно оформленного заказа из элемента.

### Слой коммуникации

#### Класс AppApi

Класс расширяет функциональность класса `Api`, предоставляя методы для взаимодействия с API магазина.

Поля:

- `cdn: string:` поле, содержащее URL-адрес контентного сервера (CDN), используемого для загрузки изображений продуктов.

`constructor(cdn: string, baseUrl: string, options?: RequestInit):` Конструктор класса AppAPI принимает три параметра: cdn - URL-адрес контентного сервера, baseUrl - базовый URL-адрес API, и options - необязательный объект параметров запроса.

Методы:

- `getProductList(): Promise<IProduct[]>:` отправляет запрос к API для получения списка продуктов.
- `orderProducts(order: IOrder): Promise<IPayedOrder>:` отправляет запрос к API для оформления заказа.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.

_Список всех событий, которые могут генерироваться в системе:_

- `items:changed` - изменение массива карточек товаров
- `item:selected` - клик по карточке товара на главной странице
- `preview:changed` - изменение открываемой в модальном окне карточки товара
- `basket:open` - открытие модального окна корзины
- `basket:changed` - изменение количества товаров в корзине и итоговой суммы
- `basket:order` - окрывается первая форма заказа / создание заказа
- `order.payment:change` - меняется способ оплаты
- `order.address:change` - меняется адрес
- `orderFormErrors:change` - отображаются ошибки формы и блокируется кнопка оформления
- `order:submit` - открывается форма контактных данных
- `contacts.phone:change` - меняется телефон
- `contacts.email:change` - меняется электронная почта
- `contactsFormErrors:change` - отображаются ошибки формы и блокируется кнопка оформления
- `contacts:submit` - отправляется запрос на сервер с заказом, открывается модальное окно с подтверждение оплаты
