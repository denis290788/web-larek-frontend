# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

Товар

```
export interface IItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
    add(item: IItem): IItem;
    remove(item: IItem): void;
    isInBasket(id: string): boolean;
}
```

Карточка товара (по запросу на сервер)

```
export interface IProduct {
	id: string;
	name: string;
	price: number | null;
	description: string;
	category: string;
	image: string;
}
```

Модель хранения массива товаров

```
export interface IItemsData {
    items: IItem[];
    preview: string | null;
}
```

Корзина

```
export interface IBasket {
    basket: TItemInBasketInfo[];
    total: number;
    getItems(): IItem[];
    makeOrder(items: TItemInBasketInfo[]): IOrder;
}
```

Заказ

```
export interface IOrder {
    items: IItem[];
    payment: 'online' | 'cash';
    address: string;
    phone: string;
    email: string;
    total: number;
    pay(): IPayedOrder;
}
```

Оплаченный заказ

```
export interface IPayedOrder {
    id: string;
    total: number;
}
```

Данные карточки для отображения на главной странице

```
export type TItemInfo = Pick<IItem, 'image' | 'title' | 'category' | 'price'>;
```

Данные карточки для отображения в корзине

```
export type TItemInBasketInfo = Pick<IItem, 'title' | 'price'>;
```

Контактные данные для оформления заказа

```
export type TOrderContacts = Pick<IOrder, 'phone' | 'email'>;
```

Информация для оформления заказа

```
export type TOrderInfo = Pick<IOrder, 'payment' | 'address'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс AppState

Класс отвечает за хранение и логику работы с товарами.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- items: IItem[] - массив карточек переданный от сервера
- basket: IItem[] - массив карточек в корзине
- order: IOrder - в свойстве хранится объект заказа, который будет отправлен на сервер
- preview: string | null - id товара для просмотра
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы класса:

- updateItem(item: IItem): void; - обновляет данные карточки в массиве.
- getItem(itemId: string): IItem; - возвращает товар по его id
- clearBasket(): void - метод отчистки корзины
- getTotal(): number - возвращает общую сумму заказа
- setCatalog(items: IItem[]) - метод создания каталога товаров переданных от сервера
- setPreview(item: IItem) - метод формирования превью товара при событии клика по карточке товара

#### Класс Item

Данный класс отвечает за хранение и работу со всеми товарами, представленными в магазине (переданными по запросу от сервера).
Поля класс:

- \_id: string;
- description: string;
- image: string;
- title: string;
- category: string;
- price: number | null;

Методы класса:

- add(): void - добавляет товар в корзину
- remove(): void - удаляет товар из корзины
- setData(itemData: IItem): void - заполняет атрибуты элементов карточки товара данными.
- isInBasket(): boolean - метод проверяет наличие данного товара в корзине

#### Класс Basket

Класс отвечает за хранение и логику работы с товарами, добавленными в корзину.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- basket: TItemInBasketInfo[] - массив товаров добавленных в карзину
- total: number - общая стоимость всех товаров в карзине
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы класса:

- getItems(): IItem[] - возвращает массив товаров в корзине
- makeOrder(items: TItemInBasketInfo[]): void - добавляет в заказ массив товаров из корзины
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс Order

Класс отвечает за хранение и логику работы с данными текущего заказа.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- items: IItem[] - массив товаров в заказе
- payment: 'online' | 'cash' - тип оплаты заказа
- address: string - адрес доставки заказа
- phone: string - контактный телефон
- email: string - контактная электронная почта
- total: number - итоговая сумма заказа
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы класса:

- getOrderInfo(order: IOrder): void - возвращает информацию о заказе
- payOrder(order: IOrder): IPayedOrder - возвращает объект оплаченного заказа
- checkOrderInfoValidation(data: Record<keyof TOrderInfo, string>): boolean - проверяет информацию о заказе на валидность
- checkOrderContactsValidation(
  data: Record<keyof TOrderContacts, string>
  ): boolean - проверяет контактные данные в заказе на валидность
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Component

Абстрактный класс, от которого наследуют методы все остальные классы представления

Методы:

- toggleClass(element: HTMLElement, className: string, force?: boolean) - Переключить класс
- setText(element: HTMLElement, value: unknown) - Установить текстовое содержимое
- setHidden(element: HTMLElement) - Скрыть элемент
- setVisible(element: HTMLElement) - показать элемент
- render(data?: Partial<T>): HTMLElement - возвращает корневой DOM-элемент

#### Класс Page

Класс представления главной страницы. Свойствами класс будут такие элементы страниы, как каталог товаров, кнопка корзины, счетчик товаров в корзине.

Методы:

- counter(value: number) - сеттер счетчика
- catalog(items: HTMLElement[]) - сеттер каталога товаров

#### Класс ItemCard

Отвечает за отображение карточки товара. Класс используется для отображения карточки товара на главной странице, в модальном окне и в корзине. В конструктор класса передается DOM элемент темплейта для формирования карточки в разных вариантах верстки. \
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий. Для полей класса реализованы ссеттеры и геттеры. \

Поля класса:

- title: HTMLElement;
- image: HTMLImageElement;
- description?: HTMLElement;
- button: HTMLButtonElement;
- category: HTMLElement
- price: HTMLElement

#### Класс Modal

Реализует модальное окно. Предоставляет методы `open` и `close` для его открытия и закрытия, сеттер для отображения контента в модальном окне. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса

- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс BasketModal

Реалезует модальное окно корзины, в котором отображается список карточек, общая стоимость товаров корзине и кнопка оформления заказа. При нажатии кнопки оформления заказа создается объект заказа.

- constructor(selector: string, events: IEvents) Конструктор принимает темплейт для отображения корзины в модальном окне и экземпляр класса `EventEmitter` для возможности инициации событий. Добавляется слушатель на кнопку для создания заказа.

Поля класса

- \_list: HTMLElement - в данном элементе отображается список карточек
- \_total: HTMLElement - общая стоимость товаров в корзине
- \_button: HTMLElement - кнопка оформления заказа

Методы:

- items(items: HTMLElement[]) - сеттер для отображения списка карточек
- total(total: number) - сеттер для отображения общей суммы

#### Класс OrderInfoForm

Реалезует модальное окно с формой информации о заказе. При сабмите данные из формы присваиваются соответствующим полям объекта заказа.
Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

Поля класса:

- submitButton: HTMLButtonElement - Кнопка подтверждения
- \_form: HTMLFormElement - элемент формы
- paymentMethod - поле способа оплаты товара
- inputAddress: HTMLInputElement - значение поля адреса
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInfoValues(): IOrder - возвращает объект заказа с данными из полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текста ошибки под под формой
- showInputError (errorMessage: string): void - отображает полученный текст ошибки
- hideInputError (): void - очищает текст ошибки
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку перехода на следующую форму заказа

#### Класс OrderContactsForm

Реалезует модальное окно с формой контактных данных пользователя. При сабмите данные из формы присваиваются соответствующим полям объекта заказа.
Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

Поля класса:

- submitButton: HTMLButtonElement - Кнопка оплаты заказа
- \_form: HTMLFormElement - элемент формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): IOrder - возвращает объект заказа с данными из полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текста ошибки под под формой
- showInputError (errorMessage: string): void - отображает полученный текст ошибки
- hideInputError (): void - очищает текст ошибки
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку оплаты заказа

#### Класс OrderSuccess

Данный класс нужен для подтверждения успешной оплаты заказа.
При открытии модально окна, получает данные о стоимости уже оплаченного заказа, которые нужно показать.

- constructor(selector: string, events: IEvents) Конструктор принимает темплейт для отображения успешности оплаты в модальном окне и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класс:

- total: number - поле стоимости заказа
- close: HTMLElement - кнопка "За новыми покупками". При нажатии закрывается окно

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.

_Список всех событий, которые могут генерироваться в системе:_

- `items:changed` - изменение массива карточек товаров
- `item:changed` - изменение карточки (если карточка уже в корзине, то кнопка "В корзину" не доступна)
- `item:selected` - изменение открываемой в модальном окне карточки товара
- `item:bye` - добавить товар в корзину
- `basket:open` - открытие модального окна корзины
- `item:delete` - удалить товар из корзины
- `basket:changed` - изменение количества товаров в корзине и итоговой суммы
- `basket:order` - создание заказа
- `order:input` - изменение данных в форме с информацией о заказе
- `order:validation` - событие, сообщающее о необходимости валидации формы данных заказа
- `order:submit` - сохранение данных в форме с информацией о заказе
- `contacts:input` - изменение данных в форме с контактными данными для заказа
- `contacts:validation` - событие, сообщающее о необходимости валидации формы контактных данных
- `contacts:submit` - сохранение данных в форме с контактными данными для заказа
- `order-success:open` - открытие модального окна с подтверждением успешности оплаты
